<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="./component/main.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./utility/auth.js"></script>
    <link rel="icon" href="../NEW-LOGO-SBE.png" type="image/ico" />
    <title>VJS alat ukur</title>
</head>
<body class="font-[Poppins] h-[100vh] w-[100vw] bg-slate-300 flex-row custom_scroll">
        <div class='loading z-20'></div>
<script type="module">
    // all Import module
    import {
        button,
        addButton,
        minusButton,
        dtlist,
        textInput,
        hiddenInput,
        loading,
        header,
        main,
        section,
        aside,
        div,
        customTable,
        createTr,
        createTd,
        td_input,
        td_button,
        td_select,
        text,
        form,
        navigation,
        searchbar,
        selectionRow,
        selectionCol,
        table,
        inputTable,
        inputEmptyRow,
    } from './component/index.js';

    import {
        //proses
        delete_cache,cache,get_cache,
        showDelBtn, del_process,
        dl_process,
        insertUpdateProcess,
        searchProcess,
        numberToStr, 
        currentDate,
        curDate,
        jsonToCsv,
        jsonToExcel,
        convertDateFormat,
        getCustomDate,
        activeLink,
        activeLink2,
        removeSpaces,
        //class
        master,
        point,
        reff,
        vjs_log, 
    } from './utility/index.js';
    import {navArr} from './general.js';

    // navigation
    navigation('VJS Alat Ukur', navArr)

    // header
    header('fixed flex flex-col top-[5vh] bg-slate-700 w-screen h-[18vh]');
        const alat_detail = await master.dbProcess('get','');
        await dtlist('tool_list', '_', alat_detail, 'sn_id', 'new_subcat', '_desc', 'loc');
        div('main_search', 'header','flex flex-row w-full');
        text({target: `#main_search`, text: 'Pilih Alat', ID: 'labelMain', style:'pl-8 text-lg font-semibold text-white mt-3 w-[18vw]'})
        textInput({target:`#main_search`, text: 'pilih alat', ID:'pickAlat', style:'rounded px-4 ml-4 text-lg h-[1.6rem] mt-3 w-[70vw]', dtlist: 'tool_list'});
        const header_main = [
            {divID: 'card1', text:'Deskripsi Alat', ID: 'desc'},
            {divID: 'card2', text:'Kategori', ID: 'cat'},
            {divID: 'card3', text:'No Seri', ID: 'no_seri'},
            {divID: 'card3', text:'Lokasi', ID: 'lokasi'},
        ]
        header_main.forEach(dt=>{
            div(dt.divID, 'header','flex flex-row w-full');
            text({target: `#${dt.divID}`, text: dt.text, ID: dt.ID, style:'pl-8 w-[20vw] text-lg mt-3 text-white'})
            textInput({target: `#${dt.divID}`, disable:'true', ID:dt.ID, data:dt.text, style:'w-[80vw] bg-transparent text-white text-xl font-bold mt-3'});
        })
        const bodyDiv = document.querySelector('body');
        bodyDiv.removeChild(document.querySelector('.loading'));    
        

    // main
    main('fixed flex flex-row top-[23vh] bg-slate-300 w-full h-[77vh]');
        let filterValue = document.querySelector('[data-input = "input__pickAlat"]');
        let no_seri = document.querySelector('[data-input = "input__no_seri"]');
        let cat_alat = document.querySelector('[data-input = "input__cat"]');
        let desc_alat = document.querySelector('[data-input = "input__desc"]');
        let location = document.querySelector('[data-input = "input__lokasi"]');
        let detail = '';
        let vjs_trans = [];
        let check_point =[]; // for 
        let period = []; // for period list
        let vjs_date = []; // for detail date per period
        customTable({
                target: 'main',
                divID: 'main_table',
                tableID: 'value',
                style: ''
            },
            {
                th: [
                    {text: 'point', style: 'fixed left-0 w-[10vw] bg-blue-700  h-[8vh] pt-5 border-2 border-black text-white uppercase'},
                    {text: 'standard', style: 'fixed left-[10vw] w-[10vw] bg-blue-700 h-[8vh] pt-5 border-2 border-black text-white uppercase'},
                    {text: 'Bulan', style: 'fixed left-[20vw] w-[80vw] bg-blue-700 h-[4vh] border-2 border-black text-white uppercase'},
                ]
            })
        const tableDiv = document.querySelector('[data-table = "value"]');
        tableDiv.appendChild(createTr('filter', 'pk'));
        const tr = document.querySelector('[data-id = "pk"]');
        tr.appendChild(createTd('','test','1'));
        const td = document.querySelector()

        //vjs_trans.sort((a,b) => {
        //        if (a.date !== b.date) return b.date.localeCompare(a.date);
        //    })
        
        //const arrayDetail = [
        //    {header:'cek day', field: 'day', type:'input'},
        //    {header:'Point Check', field: 'check_point', type:'input'},
        //    {header:'Standard', field: 'std', type:'input'},
        //    {header:'hasil', field: 'answer', type:'input'},
        //];
        //customTable({target:`#main_section2`, ID:'detail'},vjs_daily,arrayDetail)


    // event listener
    // change event listener
     document.addEventListener('change', async function(event) {
        if(event.target.getAttribute('data-input') === 'input__pickAlat') {
            filterValue = document.querySelector('[data-input = "input__pickAlat"]');
            let splitValue = filterValue.value.split('__');
            no_seri.value = splitValue[0];
            cat_alat.value = splitValue[1];
            desc_alat.value = splitValue[2];
            location.value = splitValue[3];
            vjs_trans = await vjs_log.dbProcess('fetch',{trans_date: currentDate()});
            detail = alat_detail.filter(item=>item.sn_id === no_seri.value);
            console.log(detail);
            check_point = await point.dbProcess('fetch',{new_cat: cat_alat.value});
            console.log({check_point});
            if(vjs_trans.length === 0) {
                const data = [{
                    sn_id: no_seri.value,
                    category: cat_alat.value,
                    no_asset: '',
                    check_point: '',
                    standard: '',
                    trans_date: currentDate(),
                    period: '',
                    result:''
                }]
                const result = await vjs_log.dbProcess('insert', data);
                
            }
            return;
        }
    })

    // click event listener
    document.addEventListener('click', async function(event) {
        if(event.target.getAttribute('data-filter')) {

            return;
        }
    })

    // keydown event listener
    document.addEventListener('keydown', function(event) {
        if (event.key === "Enter") {
            const submit_btn = document.querySelector('#search_btn__pick_now');
            submit_btn.click();
        }
    })
</script>
<script src="../assets/template/library/sheetjs/xlsx.full.min.js"></script>
</body>
</html>